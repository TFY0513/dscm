<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.84.0">
    <title>View Durian</title>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/dashboard/">

    <link href="product.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.2/css/jquery.dataTables.min.css" rel="stylesheet">

    <!-- CSS -->


    <!-- JavaScript -->

    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }
    </style>



</head>
<%- include('../authentication/authorized'); %>
    <%- include('../authentication/clientRole'); %>

        <body>
            <%- include('../partials/home_navbar'); %>
                <%- include('../partials/home_sidebar'); %>
                    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
                    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
                    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                    <script type="text/javascript"
                        src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
                    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                        <div
                            class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Durian Available</h1>
                        </div>

                        <section class="section-products">
                            <div class="container">
                                <div class="row justify-content-center text-center">
                                    <div class="col-md-8 col-lg-6">
                                        <div class="header">

                                            <h2>Featured Durians</h2>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <!-- Single Product -->
                                    <div class="col-md-6 col-lg-4 col-xl-3">
                                        <div id="product-1" class="single-product">
                                            <div class="part-1">
                                                <ul>
                                                    <li>
                                                        <p style="background-color: white;" data-toggle="modal"
                                                            data-target="#buyDurianModal"><img src="shopcartIcon.png"
                                                                width="40px;"></p>
                                                    </li>

                                                </ul>
                                            </div>
                                            <div class="part-2">
                                                <h3 class="product-title">Durian</h3>
                                                <h4 class="product-title">31928319239</h4>
                                                <h4 class="product-price" id="prod1">RM 11.11</h4>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Single Product -->

                                </div>
                            </div>
                        </section>
                    </main>

                    <div class="modal fade" id="buyDurianModal" tabindex="-1" role="dialog"
                        aria-labelledby="myModalLabel">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="myModalLabel">Edit Durian Modal</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <iframe name="dummyframe" id="dummyframe" style="display: none;"></iframe>
                                    <form target="dummyframe">


                                        <div class="row g-3">


                                            <div style="padding-left:20px; padding-right:20px;" class="col-6">
                                                <h4 class="mb-3">Durian ID</h4>

                                                <input type="input" class="form-control" name="editDurianType"
                                                    id="durianID" maxlength="15" placeholder="XXXXXXXX" required
                                                    value="dd" disabled>

                                                <span class="text-danger text-left"></span>
                                            </div>



                                            <!-- <div style="padding-left:20px; padding-right:20px;" class="col-6">
                                                <h4 class="mb-3">Quantity</h4>
                                                <input type="number" class="form-control" name="qty" id="qty"
                                                    name="quantity" min="1" max="20" required>


                                            </div> -->

                                            <div style="padding-left:20px; padding-right:20px;" class="col-6">
                                                <h4 class="mb-3">Price (RM)</h4>
                                                <input type="input" class="form-control" name="totalPrice"
                                                    id="totalPrice" placeholder="?" value="333dd" disabled>


                                            </div>
                                        </div><br />
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" id="addToCartBtn">Add to Cart
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>


                    <%- include('../partials/scroll_button'); %>


                        <script>
                            const ABI = JSON.parse(localStorage.getItem("UserABI"));
                            const Address = localStorage.getItem("UserAddress")
                            console.log(JSON.parse(localStorage.getItem("cart")));



                            // let cartItems = JSON.parse(localStorage.getItem('cart'));
                            // cartItems.forEach(function (item) {
                            //     // Create a div to hold the details of the item
                            //     console.log("Item name:" + item.durianID);

                            // });

                            // $("#qty").on('input', function () {
                            //     let fullString = document.getElementById("prod1").innerHTML;
                            //     let separateString = fullString.split("RM ");

                            //     const totalprice = separateString[1] * document.getElementById("qty").value;
                            //     document.getElementById("totalPrice").value = "RM " + totalprice.toFixed(2);;

                            // });


                            document.getElementById('addToCartBtn').addEventListener('click', function (e) {
                                e.preventDefault();
                                // var durianID = document.getElementById("durianID").value;
                                // var totalPrice = document.getElementById("totalPrice").value;
                                var durianID = "222";
                                var totalPrice = "3333";
                                // let item = [durianID, totalPrice];

                                // convert the array to a JSON string
                                // let array = JSON.stringify(cart);
                                // Get the current cart data from Local Storage
                                let cart = JSON.parse(localStorage.getItem("cart")) || [];

                                // Define the product you want to add to the cart
                                let durian = {
                                    durianID: durianID,
                                    totalPrice: totalPrice
                                };

                                // Check if the product already exists in the cart
                                let existingProduct = cart.find(item => item.durianID === durian.durianID);

                                if (!existingProduct) {
                                    cart.push(durian);
                                }

                                // Store the updated cart data back into Local Storage
                                localStorage.setItem("cart", JSON.stringify(cart));


                                Swal.fire({
                                    title: 'Add To Cart Succesful',
                                    text: 'You may view the shopping cart',
                                    icon: 'success',
                                    confirmButtonText: 'OK'
                                }).then(function () {
                                    window.location.href = '/clientViewDurian';
                                });
                               
                                console.log(JSON.parse(localStorage.getItem("cart")));
                            });

                            // const showDetail = async () => {
                            //     const accounts = await ethereum.request({ method: "eth_requestAccounts" });
                            //     account = accounts[0];
                            //     window.web3 = await new Web3(window.ethereum); //how to access to smart contract
                            //     window.UserContract = await new window.web3.eth.Contract(ABI, Address); //how you create an instance of that contract by using the abi and address

                            // }



                        </script>